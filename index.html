<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BATU Schedule | Pro Audio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --danger: #ef4444; --success: #10b981; --bg: #f8fafc; --card-bg: #ffffff; --text: #1e293b; --border: #e2e8f0; }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; padding-bottom: 120px; }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: var(--primary); margin: 0; font-weight: 800; font-size: 1.8em; letter-spacing: -0.5px; }
        .header p { color: #64748b; margin-top: 5px; font-size: 0.9em; }

        /* Notification Banner (Toast) Style */
        #notification-banner {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            background: #1e293b; color: white; padding: 15px 25px; border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 9999;
            display: flex; align-items: center; gap: 15px; transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 90%; max-width: 400px; border: 1px solid rgba(255,255,255,0.1);
        }
        #notification-banner.show { top: 20px; }
        .bell-icon { font-size: 1.5em; animation: ring 1s infinite; }
        @keyframes ring { 0%{transform:rotate(0deg)} 25%{transform:rotate(15deg)} 50%{transform:rotate(-15deg)} 75%{transform:rotate(5deg)} 100%{transform:rotate(0deg)} }

        /* Floating Action Bar */
        .controls { 
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            padding: 10px 20px; borderRadius: 50px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.15); display: flex; gap: 10px; z-index: 1000;
            border: 1px solid var(--border); width: max-content;
        }
        .btn { padding: 10px 20px; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; font-size: 0.9em; transition: 0.2s; display: flex; align-items: center; gap: 5px; }
        .btn-edit { background: var(--primary); color: white; }
        .btn-save { background: var(--success); color: white; display: none; }
        .btn-reset { background: #f1f5f9; color: #64748b; }
        .btn:active { transform: scale(0.95); }

        .filter-section { margin-bottom: 25px; text-align: center; }
        .filter-section select { 
            padding: 12px 20px; font-size: 1em; border: 2px solid #e2e8f0; 
            border-radius: 12px; width: 100%; max-width: 350px; 
            background: white; font-weight: 600; color: var(--text); outline: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .day-section { margin-bottom: 35px; }
        .day-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .day-title { background: var(--text); color: white; padding: 6px 16px; border-radius: 8px; font-weight: 700; font-size: 1em; }
        
        .btn-add-class {
            background: transparent; border: 2px dashed #cbd5e1; color: #64748b;
            padding: 5px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85em; font-weight: 600;
            display: none;
        }
        
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }

        .card { 
            background: var(--card-bg); padding: 16px; border-radius: 16px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid var(--border);
            border-left: 5px solid #cbd5e1; position: relative; transition: all 0.2s;
        }
        .card.lecture { border-left-color: #3b82f6; background: #eff6ff; }
        .card.lab { border-left-color: #f59e0b; background: #fffbeb; }

        body.editing .card { border: 2px dashed var(--primary); animation: shake 0.3s; }
        body.editing .btn-save { display: flex; }
        body.editing .btn-add-class { display: block; }
        body.editing .delete-btn { display: block; }
        body.editing .edit-select { display: block; }
        body.editing .badge { display: none; }
        
        [contenteditable="true"] { border-bottom: 1px dashed #94a3b8; outline: none; min-width: 20px; }
        [contenteditable="true"]:focus { background: rgba(255,255,255,0.8); border-bottom-style: solid; }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .time { font-weight: 700; color: var(--primary); font-size: 0.95em; }
        
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge.lecture { background: #3b82f6; color: white; }
        .badge.lab { background: #f59e0b; color: white; }

        .edit-select { display: none; padding: 2px 5px; font-size: 0.8em; border-radius: 4px; border: 1px solid #ccc; }
        .delete-btn {
            position: absolute; top: -10px; right: -10px; background: var(--danger); color: white;
            width: 25px; height: 25px; border-radius: 50%; border: none; cursor: pointer;
            display: none; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 10;
        }

        .subject { font-size: 1.1em; font-weight: 800; margin-bottom: 8px; line-height: 1.3; color: var(--text); }
        .details { font-size: 0.9em; color: #475569; display: flex; flex-direction: column; gap: 4px; }
        .active-badge { background: var(--success); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7em; font-weight: 700; margin-left: 8px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="notification-banner">
        <div class="bell-icon">üîî</div>
        <div id="notification-text">Class starting now!</div>
    </div>

    <div class="header">
        <h1>BATU Schedule</h1>
        <p>Smart Edition üîä</p>
    </div>

    <div class="filter-section">
        <select id="groupSelect" onchange="applyFilter()">
            <option value="all">Show All Groups</option>
            <optgroup label="Cohort 1"><option value="C1_1A">Sec 1-A</option><option value="C1_1B">Sec 1-B</option><option value="C1_2A">Sec 2-A</option><option value="C1_2B">Sec 2-B</option><option value="C1_3A">Sec 3-A</option><option value="C1_3B">Sec 3-B</option><option value="C1_4A">Sec 4-A</option><option value="C1_4B">Sec 4-B</option></optgroup>
            <optgroup label="Cohort 2"><option value="C2_1A">Sec 1-A</option><option value="C2_1B">Sec 1-B</option><option value="C2_2A">Sec 2-A</option><option value="C2_2B">Sec 2-B</option><option value="C2_3A">Sec 3-A</option><option value="C2_3B">Sec 3-B</option><option value="C2_4A">Sec 4-A</option><option value="C2_4B">Sec 4-B</option></optgroup>
            <optgroup label="Cohort 3"><option value="C3_1A">Sec 1-A</option><option value="C3_1B">Sec 1-B</option><option value="C3_2A">Sec 2-A</option><option value="C3_2B">Sec 2-B</option><option value="C3_3A">Sec 3-A</option><option value="C3_3B">Sec 3-B</option><option value="C3_4A">Sec 4-A</option><option value="C3_4B">Sec 4-B</option></optgroup>
        </select>
    </div>

    <div id="schedule-container"></div>

    <div class="controls">
        <button class="btn btn-edit" onclick="toggleEditMode()">‚úèÔ∏è Edit</button>
        <button class="btn btn-save" onclick="saveChanges()">üíæ Save</button>
        <button class="btn btn-reset" onclick="resetData()">‚Ü∫ Reset</button>
    </div>

    <script>
        // --- Data Structure ---
        const defaultData = [
            {
                day: "Saturday",
                classes: [
                    { id: 1, time: "09:40 - 11:00", subject: "Technical English 2", type: "lecture", instructor: "Dr. Mohamed El-Kadeem", location: "Hall 101", targets: ["C1_ALL"] },
                    { id: 2, time: "11:40 - 01:00", subject: "Programming Essentials in C", type: "lab", instructor: "TBA", location: "University Lab", targets: ["C1_1A", "C1_1B"] },
                    { id: 3, time: "11:40 - 01:00", subject: "Programming Essentials in C", type: "lab", instructor: "TBA", location: "Oasis Lab", targets: ["C1_3A", "C1_3B"] },
                    { id: 4, time: "01:00 - 02:20", subject: "Programming Essentials in C", type: "lab", instructor: "TBA", location: "Oasis Lab", targets: ["C1_2A", "C1_2B"] },
                    { id: 5, time: "01:00 - 02:20", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 203", targets: ["C1_4A"] },
                    { id: 6, time: "01:00 - 02:20", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 202", targets: ["C1_4B"] },
                    { id: 7, time: "09:00 - 10:20", subject: "Programming C", type: "lab", instructor: "TBA", location: "Oasis Lab", targets: ["C2_4A", "C2_4B"] },
                    { id: 8, time: "09:00 - 10:20", subject: "Mathematics 2", type: "lab", instructor: "TBA", location: "Hall 315", targets: ["C2_2A", "C2_2B"] },
                    { id: 9, time: "10:20 - 11:40", subject: "Technical English 2", type: "lecture", instructor: "Dr. Mohamed El-Kadeem", location: "Hall 101", targets: ["C2_ALL"] },
                    { id: 10, time: "11:40 - 01:00", subject: "Programming C", type: "lab", instructor: "TBA", location: "University Lab", targets: ["C2_1A", "C2_1B"] },
                    { id: 11, time: "11:40 - 01:00", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 203/202", targets: ["C2_2A", "C2_2B"] },
                    { id: 12, time: "11:40 - 01:00", subject: "Programming C", type: "lab", instructor: "TBA", location: "Oasis Lab", targets: ["C2_3A", "C2_3B"] },
                    { id: 13, time: "01:00 - 02:20", subject: "Programming C", type: "lab", instructor: "TBA", location: "University Lab", targets: ["C2_3A", "C2_3B"] },
                    { id: 14, time: "09:00 - 10:20", subject: "Programming C", type: "lab", instructor: "TBA", location: "University Lab", targets: ["C3_1A", "C3_1B"] },
                    { id: 15, time: "09:00 - 10:20", subject: "Mathematics 2", type: "lab", instructor: "TBA", location: "Hall 315", targets: ["C3_2A", "C3_2B"] },
                    { id: 16, time: "10:20 - 11:40", subject: "Programming C", type: "lab", instructor: "TBA", location: "Oasis Lab", targets: ["C3_3A", "C3_3B"] },
                    { id: 17, time: "10:20 - 11:40", subject: "Mathematics 2", type: "lab", instructor: "TBA", location: "Hall 315", targets: ["C3_4A", "C3_4B"] },
                    { id: 18, time: "11:40 - 01:00", subject: "Programming C", type: "lab", instructor: "TBA", location: "University Lab", targets: ["C3_4A", "C3_4B"] },
                    { id: 19, time: "11:40 - 01:00", subject: "Mathematics 2", type: "lab", instructor: "TBA", location: "Hall 315", targets: ["C3_1A", "C3_1B"] },
                    { id: 20, time: "11:40 - 01:00", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 202/203", targets: ["C3_2A", "C3_2B"] },
                    { id: 21, time: "01:00 - 02:20", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 202/203", targets: ["C3_3A", "C3_3B"] }
                ]
            },
            {
                day: "Sunday",
                classes: [
                    { id: 22, time: "09:00 - 10:20", subject: "Mathematics 2", type: "lecture", instructor: "Dr. Mohamed El-Shazly", location: "Hall 101", targets: ["C1_ALL"] },
                    { id: 23, time: "10:20 - 11:40", subject: "Intro To IOT", type: "lecture", instructor: "Dr. Osama / Dr. Basant", location: "Hall 101", targets: ["C1_ALL"] },
                    { id: 24, time: "11:40 - 01:00", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 316/207", targets: ["C1_3A", "C1_3B"] },
                    { id: 25, time: "11:40 - 01:00", subject: "Mathematics 2", type: "lab", instructor: "TBA", location: "Hall 304", targets: ["C1_4A", "C1_4B"] },
                    { id: 26, time: "11:40 - 01:00", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 202/203", targets: ["C1_1A", "C1_1B"] },
                    { id: 27, time: "01:00 - 02:20", subject: "Mathematics 2", type: "lab", instructor: "TBA", location: "Hall 304", targets: ["C1_2A", "C1_2B"] },
                    { id: 28, time: "01:00 - 02:20", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 202/203", targets: ["C1_2A", "C1_2B"] },
                    { id: 29, time: "01:00 - 02:20", subject: "Mathematics 2", type: "lab", instructor: "TBA", location: "Hall 216", targets: ["C1_1A", "C1_1B"] },
                    { id: 30, time: "09:00 - 10:20", subject: "Microsoft Office", type: "lecture", instructor: "Dr. Haymen El-Sayed", location: "Hall 118", targets: ["C2_ALL"] },
                    { id: 31, time: "10:20 - 11:40", subject: "Programming C", type: "lecture", instructor: "Dr. Dina Abdelhafez", location: "Hall 118", targets: ["C2_ALL"] },
                    { id: 32, time: "11:40 - 01:00", subject: "Mathematics 2", type: "lecture", instructor: "Dr. Mohamed El-Shazly", location: "Hall 118", targets: ["C2_ALL"] },
                    { id: 33, time: "01:00 - 02:20", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 207/316", targets: ["C2_3A", "C2_3B"] },
                    { id: 34, time: "09:40 - 11:00", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 207/316", targets: ["C3_1A", "C3_1B"] },
                    { id: 35, time: "09:40 - 11:00", subject: "Mathematics 2", type: "lab", instructor: "TBA", location: "Hall 304", targets: ["C3_2A", "C3_2B"] },
                    { id: 36, time: "11:40 - 01:00", subject: "Microsoft Office", type: "lecture", instructor: "Dr. Haymen El-Sayed", location: "Hall 101", targets: ["C3_ALL"] },
                    { id: 37, time: "01:00 - 02:20", subject: "Programming C", type: "lecture", instructor: "Dr. Dina Abdelhafez", location: "Hall 101", targets: ["C3_ALL"] },
                    { id: 38, time: "02:20 - 03:45", subject: "Cyber Security", type: "lecture", instructor: "Dr. Ashraf Abdelaziz", location: "Hall 101", targets: ["C3_ALL"] }
                ]
            },
            {
                day: "Wednesday",
                classes: [
                    { id: 39, time: "09:00 - 10:20", subject: "Microsoft Office", type: "lecture", instructor: "Dr. Haymen El-Sayed", location: "Hall 101", targets: ["C1_ALL"] },
                    { id: 40, time: "10:20 - 11:40", subject: "Cyber Security", type: "lecture", instructor: "Dr. Ashraf Abdelaziz", location: "Hall 101", targets: ["C1_ALL"] },
                    { id: 41, time: "11:40 - 01:00", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 202/203", targets: ["C1_4A", "C1_4B"] },
                    { id: 42, time: "11:40 - 01:00", subject: "Programming C", type: "lab", instructor: "TBA", location: "University/Oasis Lab", targets: ["C1_3A", "C1_3B"] },
                    { id: 43, time: "01:00 - 02:20", subject: "Programming C", type: "lecture", instructor: "Dr. Ghada", location: "Hall 118", targets: ["C1_ALL"] },
                    { id: 44, time: "09:00 - 10:20", subject: "Programming C", type: "lab", instructor: "TBA", location: "Oasis Lab", targets: ["C2_1A", "C2_1B"] },
                    { id: 45, time: "09:00 - 10:20", subject: "Mathematics 2", type: "lab", instructor: "TBA", location: "Hall 216/304", targets: ["C2_2A", "C2_2B", "C2_3A", "C2_3B"] },
                    { id: 46, time: "09:00 - 10:20", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 203/202", targets: ["C2_4A", "C2_4B"] },
                    { id: 47, time: "11:00 - 11:40", subject: "Cyber Security", type: "lecture", instructor: "Dr. Ashraf Abdelaziz", location: "Hall 101", targets: ["C2_ALL"] },
                    { id: 48, time: "11:40 - 01:00", subject: "Intro To IOT", type: "lecture", instructor: "Dr. Osama / Dr. Basant", location: "Hall 101", targets: ["C2_ALL"] },
                    { id: 49, time: "01:40 - 03:00", subject: "Mathematics 2", type: "lab", instructor: "TBA", location: "Hall 315/304", targets: ["C2_1A", "C2_1B", "C2_3A", "C2_3B"] },
                    { id: 50, time: "01:40 - 03:00", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 316/207", targets: ["C2_2A", "C2_2B"] },
                    { id: 51, time: "09:00 - 10:20", subject: "Mathematics 2", type: "lecture", instructor: "Dr. Mohamed El-Shazly", location: "Hall 118", targets: ["C3_ALL"] },
                    { id: 52, time: "10:20 - 11:40", subject: "Intro To IOT", type: "lecture", instructor: "Dr. Osama / Dr. Basant", location: "Hall 118", targets: ["C3_ALL"] },
                    { id: 53, time: "11:40 - 01:00", subject: "Technical English 2", type: "lecture", instructor: "Dr. Mohamed El-Kadeem", location: "Hall 118", targets: ["C3_ALL"] },
                    { id: 54, time: "01:40 - 03:00", subject: "Intro To IOT", type: "lab", instructor: "TBA", location: "Lab 203/202", targets: ["C3_4A", "C3_4B"] },
                    { id: 55, time: "01:40 - 03:00", subject: "Programming C", type: "lab", instructor: "TBA", location: "Oasis Lab", targets: ["C3_3A", "C3_3B"] }
                ]
            }
        ];

        let scheduleData = [];
        let isEditMode = false;
        let notificationSentMap = {};

        // --- In-App Notification System ---
        function triggerInAppNotification(text) {
            // 1. Show Visual Banner
            const banner = document.getElementById('notification-banner');
            document.getElementById('notification-text').innerText = text;
            banner.classList.add('show');
            
            // 2. Play Sound (Simple Beep)
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // A4 note
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5); // 0.5 seconds duration
            } catch(e) {
                console.log("Audio play failed (user interaction needed first)");
            }

            // Hide banner after 5 seconds
            setTimeout(() => {
                banner.classList.remove('show');
            }, 5000);
        }

        function checkNotifications() {
            const now = new Date();
            const daysInEnglish = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            const currentDayName = daysInEnglish[now.getDay()];

            const currentFilter = document.getElementById('groupSelect').value;
            const studentCohort = currentFilter.split('_')[0];
            
            const todayData = scheduleData.find(d => d.day === currentDayName);
            if (!todayData) return;

            const myClasses = todayData.classes.filter(cls => {
                if (currentFilter === 'all') return true;
                if (cls.targets.includes(currentFilter)) return true;
                if (cls.targets.includes(studentCohort + '_ALL')) return true;
                return false;
            });

            myClasses.forEach(cls => {
                const [startStr] = cls.time.split('-').map(s => s.trim());
                let [hours, minutes] = startStr.split(':').map(Number);
                if (hours < 8) hours += 12; 

                const classTime = new Date();
                classTime.setHours(hours, minutes, 0, 0);

                const diffMinutes = (classTime - now) / 60000;

                // 15 Min Warning
                if (diffMinutes <= 15 && diffMinutes > 14 && !notificationSentMap[cls.id + '-15min']) {
                    triggerInAppNotification(`‚è≥ ${cls.subject} starts in 15 mins!`);
                    notificationSentMap[cls.id + '-15min'] = true;
                }

                // Started Now
                if (diffMinutes <= 0 && diffMinutes > -1 && !notificationSentMap[cls.id + '-now']) {
                    triggerInAppNotification(`üî¥ ${cls.subject} has started!`);
                    notificationSentMap[cls.id + '-now'] = true;
                }
            });
        }

        // --- App Logic ---
        window.onload = () => {
            const saved = localStorage.getItem('myProScheduleV1');
            scheduleData = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(defaultData));
            
            const savedFilter = localStorage.getItem('savedCohortGroup') || 'all';
            document.getElementById('groupSelect').value = savedFilter;
            
            renderSchedule(savedFilter);

            // Check loop
            setInterval(() => {
                renderSchedule(document.getElementById('groupSelect').value);
                checkNotifications();
            }, 30000); // Check every 30 seconds
        };

        function toggleEditMode() {
            isEditMode = !isEditMode;
            document.body.classList.toggle('editing');
            const btn = document.querySelector('.btn-edit');
            btn.innerHTML = isEditMode ? '‚ùå Close' : '‚úèÔ∏è Edit';
            btn.style.background = isEditMode ? '#64748b' : 'var(--primary)';
            renderSchedule(document.getElementById('groupSelect').value);
        }

        function saveChanges() {
            isEditMode = false;
            document.body.classList.remove('editing');
            localStorage.setItem('myProScheduleV1', JSON.stringify(scheduleData));
            alert("‚úÖ Saved!");
            location.reload(); 
        }

        function resetData() {
            if(confirm("‚ö† Reset all data?")) {
                localStorage.removeItem('myProScheduleV1');
                location.reload();
            }
        }

        function updateItem(id, field, value) {
            scheduleData.forEach(day => {
                day.classes.forEach(cls => {
                    if(cls.id === id) cls[field] = value;
                });
            });
            if(field === 'type') renderSchedule(document.getElementById('groupSelect').value);
        }

        function deleteItem(id) {
            if(confirm("Delete this class?")) {
                scheduleData.forEach(day => {
                    day.classes = day.classes.filter(cls => cls.id !== id);
                });
                renderSchedule(document.getElementById('groupSelect').value);
            }
        }

        function addNewClass(dayName) {
            const currentFilter = document.getElementById('groupSelect').value;
            const newId = Date.now();
            const dayObj = scheduleData.find(d => d.day === dayName);
            if(dayObj) {
                dayObj.classes.push({
                    id: newId, time: "00:00 - 00:00", subject: "New Class", type: "lecture",
                    instructor: "Instructor", location: "Location",
                    targets: [currentFilter === 'all' ? 'C1_ALL' : currentFilter]
                });
                renderSchedule(currentFilter);
            }
        }

        function isHappeningNow(dayName, timeRange) {
            const date = new Date();
            const daysInEnglish = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            const currentDay = daysInEnglish[date.getDay()];
            if (dayName !== currentDay) return false;
            if (!timeRange) return false;
            const [startStr, endStr] = timeRange.split('-').map(s => s.trim());
            function timeToMinutes(timeString) {
                let [hours, minutes] = timeString.split(':').map(Number);
                if (hours < 8) hours += 12; 
                return (hours * 60) + minutes;
            }
            const startMins = timeToMinutes(startStr);
            const endMins = timeToMinutes(endStr);
            const currentMins = (date.getHours() * 60) + date.getMinutes();
            return currentMins >= startMins && currentMins <= endMins;
        }

        function renderSchedule(filterValue) {
            const container = document.getElementById('schedule-container');
            container.innerHTML = ''; 
            const studentCohort = filterValue.split('_')[0]; 

            scheduleData.forEach(dayData => {
                const filteredClasses = dayData.classes.filter(cls => {
                    if (filterValue === 'all') return true;
                    if (cls.targets.includes(filterValue)) return true;
                    if (cls.targets.includes(studentCohort + '_ALL')) return true;
                    return false;
                });
                filteredClasses.sort((a, b) => parseInt(a.time) - parseInt(b.time));

                if (filteredClasses.length > 0 || isEditMode) {
                    const daySection = document.createElement('div');
                    daySection.className = 'day-section';
                    const header = document.createElement('div');
                    header.className = 'day-header';
                    header.innerHTML = `<div class="day-title">${dayData.day}</div><button class="btn-add-class" onclick="addNewClass('${dayData.day}')">+ Add Class</button>`;
                    daySection.appendChild(header);
                    const grid = document.createElement('div');
                    grid.className = 'cards-grid';
                    filteredClasses.forEach(cls => {
                        const typeText = cls.type === 'lecture' ? 'Lecture' : 'Lab / Sec';
                        const active = isHappeningNow(dayData.day, cls.time);
                        const activeClass = active ? 'active-now' : '';
                        const activeBadgeHtml = active ? `<span class="active-badge">üî¥ Now</span>` : '';
                        const contentEditable = isEditMode ? 'contenteditable="true"' : '';
                        const card = document.createElement('div');
                        card.className = `card ${cls.type} ${activeClass}`;
                        const badgeHtml = isEditMode 
                            ? `<select class="edit-select" onchange="updateItem(${cls.id}, 'type', this.value)"><option value="lecture" ${cls.type === 'lecture' ? 'selected' : ''}>Lecture</option><option value="lab" ${cls.type === 'lab' ? 'selected' : ''}>Lab</option></select>`
                            : `<span class="badge ${cls.type}">${typeText}</span>`;
                        card.innerHTML = `<button class="delete-btn" onclick="deleteItem(${cls.id})">√ó</button><div class="card-header"><span class="time" ${contentEditable} onblur="updateItem(${cls.id}, 'time', this.innerText)">${cls.time}</span><div style="display:flex; align-items:center">${badgeHtml}${activeBadgeHtml}</div></div><div class="subject" ${contentEditable} onblur="updateItem(${cls.id}, 'subject', this.innerText)">${cls.subject}</div><div class="details"><div>üë®‚Äçüè´ <span ${contentEditable} onblur="updateItem(${cls.id}, 'instructor', this.innerText)">${cls.instructor}</span></div><div>üìç <span ${contentEditable} onblur="updateItem(${cls.id}, 'location', this.innerText)">${cls.location}</span></div></div>`;
                        grid.appendChild(card);
                    });
                    daySection.appendChild(grid);
                    container.appendChild(daySection);
                }
            });
        }

        function applyFilter() {
            const val = document.getElementById('groupSelect').value;
            localStorage.setItem('savedCohortGroup', val);
            renderSchedule(val);
        }
    </script>
</body>
</html>
